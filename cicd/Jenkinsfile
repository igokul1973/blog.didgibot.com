/* Requires the Kubernetes Pipeline plugin */
pipeline {
    agent {
      kubernetes {
        defaultContainer 'node-git-chromium'
        yamlFile 'cicd/node-git-chromium-pod.yaml'
      }
    }
    stages {
        // stage('Test') {
        //   steps {
        //       sh 'yarn'
        //       sh 'yarn test:headless'
        //   }
        // }
        stage('Bump version') {
          steps {
            sh "git config --global --add safe.directory ${env.WORKSPACE}"
            sh "git branch"
            sh 'npm version patch -m "Upgrade to %s commit"'
          }
        }
        stage('Commit version') {
          steps {
              sh 'git add --all && git push origin HEAD:main'
          }
        }
        stage('build') {
            steps {
                sh 'node --version'
                sh 'Building the app...'
                sh 'yarn build'
                writeFile file: 'test-results.txt', text: 'The build is finished executing'
            }
        }
    }
    post {
      success {
        archiveArtifacts 'test-results.txt'
      }
    }
}
