# Data Model: Husky Git Hooks Setup

**Feature**: 001-husky-setup  
**Date**: 2025-12-02  
**Purpose**: Data structures and configuration models for git hooks implementation

## Configuration Entities

### Package.json Scripts

#### Type Check Script

```typescript
interface ITypeCheckScript {
    name: 'check:types';
    command: 'ng build --no-emits';
    description: 'TypeScript type validation without build artifacts';
}
```

#### Husky Scripts

```typescript
interface IHuskyScripts {
    prepare: 'husky install';
    postinstall: 'husky install';
}
```

### Git Hook Configuration

#### Pre-commit Hook

```typescript
interface IPreCommitHook {
    name: 'pre-commit';
    executable: boolean;
    commands: string[];
    errorHandling: 'fail-fast';
    timeout: number; // 30 seconds max
}

interface IPreCommitConfig {
    hook: IPreCommitHook;
    commands: ['pnpm run lint', 'pnpm run check:types'];
    parallel: boolean;
}
```

#### Pre-push Hook

```typescript
interface IPrePushHook {
    name: 'pre-push';
    executable: boolean;
    commands: string[];
    errorHandling: 'fail-fast';
    timeout: number; // 2 minutes max for tests
}

interface IPrePushConfig {
    hook: IPrePushHook;
    commands: ['pnpm run test'];
    parallel: boolean;
}
```

### Dependency Configuration

#### Husky Dependency

```typescript
interface IHuskyDependency {
    name: 'husky';
    version: '^9.0.0';
    type: 'devDependency';
    optional: false;
}
```

## File Structure Model

### .husky Directory

```typescript
interface IHuskyDirectory {
    path: '.husky/';
    files: {
        'pre-commit': IHookFile;
        'pre-push': IHookFile;
        '_/husky.sh': IHuskyShim;
    };
    versionControl: boolean;
}

interface IHookFile {
    executable: boolean;
    shebang: '#!/usr/bin/env sh';
    content: string;
    permissions: '755';
}

interface IHuskyShim {
    path: '.husky/_/husky.sh';
    purpose: 'Husky bootstrap and error handling';
    autoGenerated: boolean;
}
```

## Validation Rules

### Script Validation

```typescript
interface IScriptValidation {
    mustExist: string[];
    mustBeExecutable: string[];
    timeoutLimits: Record<string, number>;
    requiredCommands: string[];
}

const validationRules: IScriptValidation = {
    mustExist: ['lint', 'test', 'check:types'],
    mustBeExecutable: ['pre-commit', 'pre-push'],
    timeoutLimits: {
        'check:types': 10000, // 10 seconds
        'pre-commit': 30000, // 30 seconds
        'pre-push': 120000 // 2 minutes
    },
    requiredCommands: ['pnpm', 'ng', 'node']
};
```

### Performance Constraints

```typescript
interface IPerformanceConstraints {
    typeCheckMaxTime: 10000; // 10 seconds
    preCommitMaxTime: 30000; // 30 seconds
    prePushMaxTime: 120000; // 2 minutes
    memoryLimit: 512; // MB
}
```

## State Management

### Hook States

```typescript
enum EHookState {
    INSTALLED = 'installed',
    MISSING = 'missing',
    PERMISSION_DENIED = 'permission_denied',
    EXECUTABLE = 'executable',
    BROKEN = 'broken'
}

interface IHookStatus {
    hookName: string;
    state: EHookState;
    lastRun?: Date;
    lastError?: string;
    executionTime?: number;
}
```

### Installation State

```typescript
interface IInstallationState {
    huskyInstalled: boolean;
    hooksConfigured: boolean;
    scriptsAdded: boolean;
    dependenciesInstalled: boolean;
    lastVerified: Date;
}
```

## Error Handling Model

### Error Categories

```typescript
enum EErrorCategory {
    MISSING_DEPENDENCY = 'missing_dependency',
    SCRIPT_FAILURE = 'script_failure',
    TIMEOUT = 'timeout',
    PERMISSION_ERROR = 'permission_error',
    CONFIGURATION_ERROR = 'configuration_error'
}

interface IHookError {
    category: EErrorCategory;
    message: string;
    command: string;
    exitCode: number;
    timestamp: Date;
}

interface IErrorHandling {
    strategy: 'fail-fast';
    logging: boolean;
    userFeedback: 'direct_output';
    recovery: 'manual_intervention';
}
```

## Integration Points

### Package Manager Integration

```typescript
interface IPackageManagerIntegration {
    manager: 'pnpm';
    scripts: Record<string, string>;
    dependencies: Record<string, string>;
    devDependencies: Record<string, string>;
}

const pnpmIntegration: IPackageManagerIntegration = {
    manager: 'pnpm',
    scripts: {
        'check:types': 'ng build --no-emits',
        prepare: 'husky install',
        postinstall: 'husky install'
    },
    dependencies: {},
    devDependencies: {
        husky: '^9.0.0'
    }
};
```

### Angular CLI Integration

```typescript
interface IAngularCliIntegration {
    command: 'ng build';
    flags: ['--no-emits'];
    configuration: 'development';
    target: 'type-checking';
}
```

This data model provides the structural foundation for implementing the Husky git hooks feature with proper validation, error handling, and integration with the existing Angular project setup.
